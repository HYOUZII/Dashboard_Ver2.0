// λ€μ‹λ³΄λ“ νƒ­ - μ—…λ¬΄ λ°©ν•΄ μ§€μ λ„μ›€λ§ μ¶”κ°€

// ... (κΈ°μ΅΄ μ½”λ“ μ μ§€, loadInterruptAnalysis ν•¨μλ§ μμ •)

async function loadInterruptAnalysis(container) {
    const chartContainer = container.querySelector('#interrupt-analysis');
    
    try {
        const interrupts = await getInterrupts();
        
        if (!interrupts || interrupts.length === 0) {
            chartContainer.innerHTML = '<p>μΈν„°λ½νΈ λ°μ΄ν„°κ°€ μ—†μµλ‹λ‹¤.</p>';
            return;
        }
        
        const deptStats = {};
        let totalHours = 0;
        
        interrupts.forEach(item => {
            const dept = item['μ”μ²­λ¶€μ„'] || 'κΈ°νƒ€';
            const hours = parseFloat(item['μμƒμ†μ”μ‹κ°„']) || 0;
            
            deptStats[dept] = (deptStats[dept] || 0) + hours;
            totalHours += hours;
        });
        
        const topDepts = Object.entries(deptStats)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5);
        
        const threshold = 50; // κΈ°μ¤€κ°’
        const isHigh = totalHours > threshold;
        
        let html = `
            <div class="interrupt-grid">
                <div>
                    <h4 style="margin-bottom: 15px;">λ¶€μ„λ³„ μΈν„°λ½νΈ μ‹κ°„</h4>
                    <div class="bar-chart">
        `;
        
        topDepts.forEach(([dept, hours]) => {
            const percent = (hours / totalHours * 100).toFixed(0);
            html += `
                <div class="bar-item">
                    <div class="bar-label">
                        <span>${dept}</span>
                        <span>${hours.toFixed(1)}μ‹κ°„</span>
                    </div>
                    <div class="bar-track">
                        <div class="bar-fill" style="width: ${percent}%;">
                            ${percent}%
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += `
                    </div>
                </div>
                
                <div>
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
                        <h4 style="margin: 0;">μ—…λ¬΄ λ°©ν•΄ μ§€μ</h4>
                        <button onclick="showDisruptionHelp()" style="
                            background: var(--info);
                            color: white;
                            border: none;
                            border-radius: 50%;
                            width: 24px;
                            height: 24px;
                            cursor: pointer;
                            font-size: 14px;
                            font-weight: bold;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        ">?</button>
                    </div>
                    
                    <div style="background: ${isHigh ? 'linear-gradient(135deg, #f093fb, #f5576c)' : 'linear-gradient(135deg, #4facfe, #00f2fe)'}; 
                                padding: 40px 20px; 
                                border-radius: 12px; 
                                text-align: center;
                                color: white;">
                        <div style="font-size: 18px; opacity: 0.9; margin-bottom: 15px;">ν„μ¬ μƒνƒ</div>
                        <div style="font-size: 64px; font-weight: bold; margin: 20px 0;">
                            ${isHigh ? 'λ†’μ' : 'μ–‘νΈ'}
                        </div>
                        <div style="font-size: 16px; opacity: 0.9;">
                            ${isHigh ? 'β οΈ μΈν„°λ½νΈκ°€ λ§μµλ‹λ‹¤' : 'β… μ•μ •μ μ…λ‹λ‹¤'}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; display: grid; gap: 10px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 13px; color: #666; margin-bottom: 5px;">μ΄ μΈν„°λ½νΈ</div>
                            <div style="font-size: 24px; font-weight: bold; color: var(--danger);">${interrupts.length}κ±΄</div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 13px; color: #666; margin-bottom: 5px;">μ΄ μ†μ‹¤ μ‹κ°„</div>
                            <div style="font-size: 24px; font-weight: bold; color: var(--warning);">${totalHours.toFixed(1)}μ‹κ°„</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        chartContainer.innerHTML = html;
        
    } catch (error) {
        console.error('μΈν„°λ½νΈ λ¶„μ„ μ¤λ¥:', error);
        chartContainer.innerHTML = '<div class="alert alert-danger">λ°μ΄ν„° λ΅λ”© μ‹¤ν¨</div>';
    }
}

// λ„μ›€λ§ ν•¨μ
function showDisruptionHelp() {
    alert(`π“ μ—…λ¬΄ λ°©ν•΄ μ§€μ κ³„μ‚° λ°©μ‹

β… μ–‘νΈ (50μ‹κ°„ μ΄ν•)
β€Ά μ›”κ°„ μΈν„°λ½νΈ μ΄ μ‹κ°„ β‰¤ 50μ‹κ°„
β€Ά ν€μ› 1μΈλ‹Ή ν‰κ·  10μ‹κ°„ μ΄ν•
β€Ά μ—°κµ¬ μ—…λ¬΄μ— μ§‘μ¤‘ κ°€λ¥ν• μƒνƒ

β οΈ λ†’μ (50μ‹κ°„ μ΄κ³Ό)
β€Ά μ›”κ°„ μΈν„°λ½νΈ μ΄ μ‹κ°„ > 50μ‹κ°„
β€Ά ν€μ› 1μΈλ‹Ή ν‰κ·  10μ‹κ°„ μ΄κ³Ό
β€Ά μ •κΈ° νμ μ‹κ°„ μ΅°μ • κ¶μ¥

π’΅ κΈ°μ¤€
5λ… ν€ κΈ°μ¤€ μ›” 160μ‹κ°„ μ¤‘
50μ‹κ°„ = μ•½ 30% (μ—…λ¬΄ μ§‘μ¤‘λ„ μ„κ³„μ )`);
}
